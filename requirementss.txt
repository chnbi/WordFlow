# WordFlow Requirements Specification

## Project States & Action Bar

### Project Details Page

| State | Condition | Action Buttons |
|-------|-----------|----------------|
| 1. Empty | No rows | Search — Import |
| 2. Pending | Rows exist, not translated | Search — Filter — Import — **Translate** (pink) |
| 3. Translated | All rows translated | Search — Filter — Import — **Send for Review** (pink) |
| 4. Selection (pending) | Rows selected, not translated | Search — **Delete** — **Translate Selected** (pink) |
| 5. Selection (translated) | Rows selected, all translated | Search — **Delete** — Translate Again — **Send for Review** (pink) |
| 6. Approved | All rows approved | Search — Filter — Import — **Export** |

### Glossary Library Page

| State | Condition | Action Buttons |
|-------|-----------|----------------|
| 1. Empty | No terms | Search — Import |
| 2. Pending | Terms exist, not translated | Search — Filter — Import — **Translate** (pink) |
| 3. Translated | All terms translated | Search — Filter — Import — **Send for Review** (pink) |
| 4. Selection | Terms selected | Search — **Delete** — Translate Selected (pink) |
| 5. Approved | All terms approved | Search — Filter — Import — **Export** |

---

## Duplicate Detection

### Criteria
- Match on **any** language field
- English/Malay: Case-insensitive comparison
- Chinese: Exact match

### Triggers
1. **Inline Add Row** → Toast warning with confirm/cancel
2. **Excel Import** → DuplicateResolutionDialog (Override/Ignore)

---

## Translation Logic

### Lite-RAG Glossary
- Pre-filter glossary to include only terms present in source text
- Reduces token consumption by ~60%

### Batch Processing
- Max batch size: 50 rows
- Response format: JSON with row IDs

### Template Variables
- `{{target_languages}}` → "Bahasa Malaysia, Chinese"
- `{{source_language}}` → "English"

---

## Status Workflow

```
pending → translated → review → approved
                ↑          ↓
            (edit reverts to translated)
```

---

## RBAC Permissions

| Action | Admin | Manager | Editor | Viewer |
|--------|-------|---------|--------|--------|
| Create Project | ✓ | ✓ | ✓ | ✗ |
| Translate | ✓ | ✓ | ✓ | ✗ |
| Edit Translation | ✓ | ✓ | ✓ | ✗ |
| Send for Review | ✓ | ✓ | ✓ | ✗ |
| Approve | ✓ | ✓ | ✗ | ✗ |
| Manage Glossary | ✓ | ✓ | ✗ | ✗ |
| Manage Prompts | ✓ | ✓ | ✗ | ✗ |

---

## Excel Format

### Import
| Column A | Column B | Column C |
|----------|----------|----------|
| English | Bahasa Malaysia | Chinese |

### Export
- Header row with grey background
- All language columns populated
